<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FTMO Challenge Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        .header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            margin-bottom: 20px;
            text-align: center;
        }
        
        .header h1 {
            color: #2d3748;
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .phase-badge {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 8px 20px;
            border-radius: 20px;
            font-size: 0.9em;
            font-weight: bold;
        }
        
        .status-banner {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            margin-bottom: 20px;
        }
        
        .status-banner.passing {
            border-left: 8px solid #48bb78;
        }
        
        .status-banner.warning {
            border-left: 8px solid #ed8936;
        }
        
        .status-banner.failing {
            border-left: 8px solid #f56565;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .card {
            background: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .card h2 {
            color: #2d3748;
            margin-bottom: 20px;
            font-size: 1.3em;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 10px;
        }
        
        .metric {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .metric:last-child {
            border-bottom: none;
        }
        
        .metric-label {
            color: #718096;
            font-weight: 500;
        }
        
        .metric-value {
            font-weight: bold;
            color: #2d3748;
        }
        
        .metric-value.positive {
            color: #48bb78;
        }
        
        .metric-value.negative {
            color: #f56565;
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e2e8f0;
            border-radius: 15px;
            overflow: hidden;
            margin: 10px 0;
            position: relative;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #48bb78 0%, #38a169 100%);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .progress-fill.danger {
            background: linear-gradient(90deg, #f56565 0%, #c53030 100%);
        }
        
        .progress-fill.warning {
            background: linear-gradient(90deg, #ed8936 0%, #dd6b20 100%);
        }
        
        .limit-indicator {
            background: #fff5f5;
            border: 2px solid #feb2b2;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }
        
        .limit-indicator.safe {
            background: #f0fff4;
            border-color: #9ae6b4;
        }
        
        .limit-indicator.warning {
            background: #fffaf0;
            border-color: #fbd38d;
        }
        
        .trades-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        
        .trades-table th {
            background: #4a5568;
            color: white;
            padding: 12px;
            text-align: left;
            font-size: 0.9em;
        }
        
        .trades-table td {
            padding: 10px;
            border-bottom: 1px solid #e2e8f0;
        }
        
        .trades-table tr:hover {
            background: #f7fafc;
        }
        
        .win {
            color: #48bb78;
            font-weight: bold;
        }
        
        .loss {
            color: #f56565;
            font-weight: bold;
        }
        
        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }
        
        .live-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            background: #48bb78;
            border-radius: 50%;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üèÜ FTMO Challenge Dashboard</h1>
            <div class="phase-badge" id="phase-badge">Phase 1</div>
        </div>
        
        <div class="status-banner safe" id="status-banner">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <span class="live-indicator"></span>
                    <strong>Status:</strong> <span id="status-text">In Progress</span>
                </div>
                <div id="last-update" style="color: #718096; font-size: 0.9em;">Last update: Loading...</div>
            </div>
        </div>
        
        <div class="grid">
            <!-- Account Overview -->
            <div class="card">
                <h2>üí∞ Account Overview</h2>
                <div class="metric">
                    <span class="metric-label">Balance</span>
                    <span class="metric-value" id="balance">$100,000.00</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Profit/Loss</span>
                    <span class="metric-value" id="profit">$0.00</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Profit %</span>
                    <span class="metric-value" id="profit-pct">0.00%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Peak Balance</span>
                    <span class="metric-value" id="peak-balance">$100,000.00</span>
                </div>
            </div>
            
            <!-- Profit Target -->
            <div class="card">
                <h2>üéØ Profit Target</h2>
                <div class="metric">
                    <span class="metric-label">Target</span>
                    <span class="metric-value" id="target">$10,000.00</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Remaining</span>
                    <span class="metric-value" id="target-remaining">$10,000.00</span>
                </div>
                <div class="progress-bar">
                    <div class="progress-fill" id="target-progress" style="width: 0%">0%</div>
                </div>
                <div class="metric">
                    <span class="metric-label">Estimated Days to Target</span>
                    <span class="metric-value" id="days-to-target">-</span>
                </div>
            </div>
            
            <!-- Drawdown Limits -->
            <div class="card">
                <h2>‚ö†Ô∏è Drawdown Limits</h2>
                <div style="margin-bottom: 20px;">
                    <strong>Daily Drawdown</strong>
                    <div class="progress-bar">
                        <div class="progress-fill" id="daily-dd-bar" style="width: 0%">0.00%</div>
                    </div>
                    <div class="limit-indicator safe" id="daily-dd-indicator">
                        <strong>Buffer:</strong> <span id="daily-dd-buffer">5.00%</span> remaining
                    </div>
                </div>
                <div>
                    <strong>Total Drawdown</strong>
                    <div class="progress-bar">
                        <div class="progress-fill" id="total-dd-bar" style="width: 0%">0.00%</div>
                    </div>
                    <div class="limit-indicator safe" id="total-dd-indicator">
                        <strong>Buffer:</strong> <span id="total-dd-buffer">10.00%</span> remaining
                    </div>
                </div>
            </div>
        </div>
        
        <div class="grid">
            <!-- Trading Stats -->
            <div class="card">
                <h2>üìä Trading Statistics</h2>
                <div class="metric">
                    <span class="metric-label">Trading Days</span>
                    <span class="metric-value" id="trading-days">0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Total Trades</span>
                    <span class="metric-value" id="total-trades">0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Trades Today</span>
                    <span class="metric-value" id="trades-today">0 / 5</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Win Rate</span>
                    <span class="metric-value" id="win-rate">0.0%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Consecutive Losses</span>
                    <span class="metric-value" id="consecutive-losses">0</span>
                </div>
            </div>
            
            <!-- Performance Metrics -->
            <div class="card">
                <h2>üìà Performance Metrics</h2>
                <div class="metric">
                    <span class="metric-label">Wins</span>
                    <span class="metric-value positive" id="wins">0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Losses</span>
                    <span class="metric-value negative" id="losses">0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Max Consecutive Losses</span>
                    <span class="metric-value" id="max-consecutive-losses">0</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Average Trade Duration</span>
                    <span class="metric-value" id="avg-duration">-</span>
                </div>
            </div>
            
            <!-- Risk Management -->
            <div class="card">
                <h2>üõ°Ô∏è Risk Management</h2>
                <div class="metric">
                    <span class="metric-label">Max Risk per Trade</span>
                    <span class="metric-value">0.5%</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Max Daily Trades</span>
                    <span class="metric-value">5</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Max Concurrent Positions</span>
                    <span class="metric-value">2</span>
                </div>
                <div class="metric">
                    <span class="metric-label">Min Risk:Reward</span>
                    <span class="metric-value">1:2</span>
                </div>
            </div>
        </div>
        
        <!-- Recent Trades -->
        <div class="card">
            <h2>üìã Recent Trades</h2>
            <table class="trades-table" id="trades-table">
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Instrument</th>
                        <th>Side</th>
                        <th>Entry</th>
                        <th>Exit</th>
                        <th>P/L</th>
                        <th>Result</th>
                    </tr>
                </thead>
                <tbody id="trades-body">
                    <tr>
                        <td colspan="7" style="text-align: center; padding: 30px; color: #a0aec0;">
                            No trades yet
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
    
    <script>
        // Fetch and update dashboard data
        async function updateDashboard() {
            try {
                const response = await fetch('/api/ftmo_status');
                const data = await response.json();
                
                // Update header
                document.getElementById('phase-badge').textContent = `Phase ${data.phase}`;
                document.getElementById('status-text').textContent = data.status;
                document.getElementById('last-update').textContent = `Last update: ${new Date().toLocaleTimeString()}`;
                
                // Update status banner
                const banner = document.getElementById('status-banner');
                banner.className = 'status-banner';
                if (data.status === 'PASSED') {
                    banner.classList.add('passing');
                } else if (data.status === 'FAILED') {
                    banner.classList.add('failing');
                } else {
                    banner.classList.add('safe');
                }
                
                // Update account overview
                document.getElementById('balance').textContent = `$${data.balance.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                
                const profitEl = document.getElementById('profit');
                profitEl.textContent = `$${Math.abs(data.profit).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                profitEl.className = 'metric-value ' + (data.profit >= 0 ? 'positive' : 'negative');
                
                const profitPctEl = document.getElementById('profit-pct');
                profitPctEl.textContent = `${data.profit_pct >= 0 ? '+' : ''}${data.profit_pct.toFixed(2)}%`;
                profitPctEl.className = 'metric-value ' + (data.profit_pct >= 0 ? 'positive' : 'negative');
                
                document.getElementById('peak-balance').textContent = `$${data.peak_balance.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                
                // Update profit target
                document.getElementById('target').textContent = `$${data.target_profit.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                document.getElementById('target-remaining').textContent = `$${data.target_remaining.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
                
                const targetProgress = document.getElementById('target-progress');
                targetProgress.style.width = `${Math.min(100, data.progress_to_target)}%`;
                targetProgress.textContent = `${data.progress_to_target.toFixed(1)}%`;
                
                document.getElementById('days-to-target').textContent = data.days_to_target_estimate 
                    ? `${Math.ceil(data.days_to_target_estimate)} days`
                    : 'N/A';
                
                // Update drawdown limits
                const dailyDDBar = document.getElementById('daily-dd-bar');
                const dailyDDPct = (data.daily_drawdown_pct / 5.0) * 100;
                dailyDDBar.style.width = `${dailyDDPct}%`;
                dailyDDBar.textContent = `${data.daily_drawdown_pct.toFixed(2)}%`;
                dailyDDBar.className = 'progress-fill';
                if (dailyDDPct > 80) dailyDDBar.classList.add('danger');
                else if (dailyDDPct > 60) dailyDDBar.classList.add('warning');
                
                document.getElementById('daily-dd-buffer').textContent = `${data.daily_buffer_pct.toFixed(2)}%`;
                const dailyIndicator = document.getElementById('daily-dd-indicator');
                dailyIndicator.className = 'limit-indicator';
                if (data.daily_buffer_pct < 1) dailyIndicator.classList.add('danger');
                else if (data.daily_buffer_pct < 2) dailyIndicator.classList.add('warning');
                else dailyIndicator.classList.add('safe');
                
                const totalDDBar = document.getElementById('total-dd-bar');
                const totalDDPct = (data.total_drawdown_pct / 10.0) * 100;
                totalDDBar.style.width = `${totalDDPct}%`;
                totalDDBar.textContent = `${data.total_drawdown_pct.toFixed(2)}%`;
                totalDDBar.className = 'progress-fill';
                if (totalDDPct > 80) totalDDBar.classList.add('danger');
                else if (totalDDPct > 60) totalDDBar.classList.add('warning');
                
                document.getElementById('total-dd-buffer').textContent = `${data.total_buffer_pct.toFixed(2)}%`;
                const totalIndicator = document.getElementById('total-dd-indicator');
                totalIndicator.className = 'limit-indicator';
                if (data.total_buffer_pct < 2) totalIndicator.classList.add('danger');
                else if (data.total_buffer_pct < 4) totalIndicator.classList.add('warning');
                else totalIndicator.classList.add('safe');
                
                // Update trading stats
                document.getElementById('trading-days').textContent = data.trading_days;
                document.getElementById('total-trades').textContent = data.total_trades;
                document.getElementById('trades-today').textContent = `${data.trades_today} / 5`;
                document.getElementById('win-rate').textContent = `${data.win_rate.toFixed(1)}%`;
                document.getElementById('consecutive-losses').textContent = data.consecutive_losses;
                
                // Update performance metrics
                document.getElementById('wins').textContent = data.wins;
                document.getElementById('losses').textContent = data.losses;
                document.getElementById('max-consecutive-losses').textContent = data.max_consecutive_losses;
                
            } catch (error) {
                console.error('Error updating dashboard:', error);
            }
        }
        
        // Update every 5 seconds
        updateDashboard();
        setInterval(updateDashboard, 5000);
    </script>
</body>
</html>



