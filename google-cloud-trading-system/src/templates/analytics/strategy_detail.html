<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Strategy Detail - {{ strategy_id }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <style>
        body { background: #0f1419; color: #e8eaed; }
        .metric-card { background: #1a1f2e; border: 1px solid #2d3748; border-radius: 12px; padding: 20px; margin-bottom: 20px; }
        .header-bar { background: #1a1f2e; padding: 20px; margin-bottom: 30px; border-bottom: 2px solid #2d3748; }
        .positive { color: #10b981; }
        .negative { color: #ef4444; }
        #equity-chart { background: #232936; border-radius: 8px; padding: 15px; }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="container">
            <h1><i class="bi bi-lightning-charge"></i> {{ strategy_id }}</h1>
            <p class="mb-0">Detailed performance analysis</p>
            <div class="mt-3">
                <a href="/" class="btn btn-sm btn-outline-secondary me-2">Back to Overview</a>
                <a href="/versions/{{ strategy_id }}" class="btn btn-sm btn-outline-primary">Version History</a>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row">
            <div class="col-md-3">
                <div class="metric-card text-center">
                    <h6 class="text-muted">Win Rate</h6>
                    <h2 id="win-rate">-</h2>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card text-center">
                    <h6 class="text-muted">Total P&L</h6>
                    <h2 id="total-pnl">-</h2>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card text-center">
                    <h6 class="text-muted">Profit Factor</h6>
                    <h2 id="profit-factor">-</h2>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-card text-center">
                    <h6 class="text-muted">Sharpe Ratio</h6>
                    <h2 id="sharpe-ratio">-</h2>
                </div>
            </div>
        </div>

        <div class="metric-card">
            <h4>Equity Curve</h4>
            <canvas id="equity-chart" height="80"></canvas>
        </div>

        <div class="metric-card">
            <h4>Recent Trades</h4>
            <div id="trades-table" class="table-responsive">
                <div class="text-center py-3">Loading trades...</div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const strategyId = "{{ strategy_id }}";

        document.addEventListener('DOMContentLoaded', function() {
            loadStrategyMetrics();
            loadPerformanceChart();
            loadRecentTrades();
        });

        async function loadStrategyMetrics() {
            try {
                const response = await fetch(`/api/strategy/${strategyId}/metrics`);
                const data = await response.json();

                if (data.success) {
                    const metrics = data.metrics;
                    document.getElementById('win-rate').textContent = (metrics.win_rate || 0).toFixed(1) + '%';
                    document.getElementById('total-pnl').textContent = '$' + (metrics.total_pnl || 0).toFixed(2);
                    document.getElementById('profit-factor').textContent = (metrics.profit_factor || 0).toFixed(2);
                    document.getElementById('sharpe-ratio').textContent = metrics.sharpe_ratio ? metrics.sharpe_ratio.toFixed(2) : 'N/A';
                }
            } catch (error) {
                console.error('Error loading metrics:', error);
            }
        }

        async function loadPerformanceChart() {
            try {
                const response = await fetch(`/api/strategy/${strategyId}/performance-chart?days=30`);
                const data = await response.json();

                if (data.success) {
                    const ctx = document.getElementById('equity-chart').getContext('2d');
                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: data.snapshots.map(s => s.date),
                            datasets: [{
                                label: 'Cumulative P&L',
                                data: data.snapshots.map(s => s.cumulative_pnl),
                                borderColor: '#4299e1',
                                backgroundColor: 'rgba(66, 153, 225, 0.1)',
                                fill: true
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: { legend: { labels: { color: '#e8eaed' } } },
                            scales: {
                                y: { ticks: { color: '#e8eaed' }, grid: { color: '#2d3748' } },
                                x: { ticks: { color: '#e8eaed' }, grid: { color: '#2d3748' } }
                            }
                        }
                    });
                }
            } catch (error) {
                console.error('Error loading chart:', error);
            }
        }

        async function loadRecentTrades() {
            try {
                const response = await fetch(`/api/strategy/${strategyId}/trades?limit=20`);
                const data = await response.json();

                if (data.success) {
                    const trades = data.trades;
                    const html = `
                        <table class="table table-dark table-striped">
                            <thead>
                                <tr>
                                    <th>Instrument</th>
                                    <th>Direction</th>
                                    <th>Entry</th>
                                    <th>Exit</th>
                                    <th>P&L</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${trades.map(trade => `
                                    <tr>
                                        <td>${trade.instrument}</td>
                                        <td>${trade.direction}</td>
                                        <td>${trade.entry_price.toFixed(5)}</td>
                                        <td>${trade.exit_price ? trade.exit_price.toFixed(5) : 'Open'}</td>
                                        <td class="${trade.realized_pnl > 0 ? 'positive' : 'negative'}">
                                            ${trade.realized_pnl ? '$' + trade.realized_pnl.toFixed(2) : '-'}
                                        </td>
                                        <td>${trade.is_closed ? 'Closed' : 'Open'}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                    document.getElementById('trades-table').innerHTML = html;
                }
            } catch (error) {
                console.error('Error loading trades:', error);
            }
        }
    </script>
</body>
</html>



