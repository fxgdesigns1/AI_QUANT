<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Analytics - Overview</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
    <style>
        body { background: #0f1419; color: #e8eaed; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .strategy-card { background: #1a1f2e; border: 1px solid #2d3748; border-radius: 12px; padding: 20px; margin-bottom: 20px; }
        .strategy-card:hover { border-color: #4299e1; transform: translateY(-2px); transition: all 0.3s; }
        .metric-box { background: #232936; padding: 15px; border-radius: 8px; margin: 10px 0; }
        .positive { color: #10b981; }
        .negative { color: #ef4444; }
        .neutral { color: #6b7280; }
        .header-bar { background: #1a1f2e; padding: 20px; margin-bottom: 30px; border-bottom: 2px solid #2d3748; }
        .nav-tabs .nav-link { color: #9ca3af; background: #1a1f2e; border: none; }
        .nav-tabs .nav-link.active { color: #4299e1; background: #232936; border-bottom: 2px solid #4299e1; }
        .badge-strategy { background: #4299e1; color: white; padding: 5px 10px; border-radius: 20px; font-size: 12px; }
        .mini-chart { height: 80px; }
    </style>
</head>
<body>
    <div class="header-bar">
        <div class="container">
            <h1><i class="bi bi-graph-up"></i> Trading Analytics Dashboard</h1>
            <p class="mb-0">Comprehensive performance tracking and analysis</p>
            <div class="mt-3">
                <a href="/" class="btn btn-sm btn-outline-primary me-2">Overview</a>
                <a href="/trades" class="btn btn-sm btn-outline-secondary me-2">Trade History</a>
                <a href="/comparison" class="btn btn-sm btn-outline-secondary me-2">Compare Strategies</a>
                <a href="/charts" class="btn btn-sm btn-outline-secondary">Charts</a>
                <a href="http://localhost:8080" target="_blank" class="btn btn-sm btn-outline-info ms-3">Main Dashboard</a>
            </div>
        </div>
    </div>

    <div class="container">
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="metric-box text-center">
                    <h6 class="text-muted">Total Strategies</h6>
                    <h2 id="total-strategies">-</h2>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-box text-center">
                    <h6 class="text-muted">Total Trades</h6>
                    <h2 id="total-trades">-</h2>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-box text-center">
                    <h6 class="text-muted">Average Win Rate</h6>
                    <h2 id="avg-win-rate">-</h2>
                </div>
            </div>
            <div class="col-md-3">
                <div class="metric-box text-center">
                    <h6 class="text-muted">Total P&L</h6>
                    <h2 id="total-pnl">-</h2>
                </div>
            </div>
        </div>

        <div id="strategies-container">
            <div class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <p class="mt-3">Loading strategies...</p>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Load strategies on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadStrategies();
            setInterval(loadStrategies, 30000); // Refresh every 30 seconds
        });

        async function loadStrategies() {
            try {
                const response = await fetch('/api/strategies');
                const data = await response.json();

                if (!data.success) {
                    throw new Error(data.error || 'Failed to load strategies');
                }

                displayStrategies(data.strategies);
                updateSummaryStats(data.strategies);
            } catch (error) {
                console.error('Error loading strategies:', error);
                document.getElementById('strategies-container').innerHTML = `
                    <div class="alert alert-danger">
                        <i class="bi bi-exclamation-triangle"></i> Error loading strategies: ${error.message}
                    </div>
                `;
            }
        }

        function displayStrategies(strategies) {
            if (!strategies || strategies.length === 0) {
                document.getElementById('strategies-container').innerHTML = `
                    <div class="alert alert-info">
                        <i class="bi bi-info-circle"></i> No strategies found. Start trading to see analytics!
                    </div>
                `;
                return;
            }

            const html = strategies.map(strategy => {
                const metrics = strategy.metrics || {};
                const winRate = (metrics.win_rate || 0).toFixed(1);
                const totalPnl = (metrics.total_pnl || 0).toFixed(2);
                const totalTrades = metrics.total_trades || 0;
                const profitFactor = (metrics.profit_factor || 0).toFixed(2);
                const sharpeRatio = metrics.sharpe_ratio ? metrics.sharpe_ratio.toFixed(2) : 'N/A';
                const maxDrawdown = (metrics.max_drawdown || 0).toFixed(2);

                const pnlClass = totalPnl > 0 ? 'positive' : totalPnl < 0 ? 'negative' : 'neutral';

                return `
                    <div class="strategy-card">
                        <div class="row align-items-center">
                            <div class="col-md-4">
                                <h4><i class="bi bi-lightning-charge"></i> ${strategy.strategy_id}</h4>
                                <div class="mt-2">
                                    <span class="badge-strategy">Version ${strategy.current_version}</span>
                                    <span class="badge bg-secondary ms-2">${strategy.open_trades_count} Open</span>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="metric-box">
                                    <small class="text-muted">Total Trades</small>
                                    <h5>${totalTrades}</h5>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="metric-box">
                                    <small class="text-muted">Win Rate</small>
                                    <h5 class="${winRate >= 50 ? 'positive' : 'negative'}">${winRate}%</h5>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <div class="metric-box">
                                    <small class="text-muted">Total P&L</small>
                                    <h5 class="${pnlClass}">$${totalPnl}</h5>
                                </div>
                            </div>
                            <div class="col-md-2">
                                <a href="/strategy/${strategy.strategy_id}" class="btn btn-primary w-100">
                                    <i class="bi bi-bar-chart"></i> Details
                                </a>
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col-md-3">
                                <small class="text-muted">Profit Factor:</small> <strong>${profitFactor}</strong>
                            </div>
                            <div class="col-md-3">
                                <small class="text-muted">Sharpe Ratio:</small> <strong>${sharpeRatio}</strong>
                            </div>
                            <div class="col-md-3">
                                <small class="text-muted">Max Drawdown:</small> <strong class="negative">$${maxDrawdown}</strong>
                            </div>
                            <div class="col-md-3">
                                <small class="text-muted">Wins/Losses:</small> <strong>${metrics.wins || 0}/${metrics.losses || 0}</strong>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('strategies-container').innerHTML = html;
        }

        function updateSummaryStats(strategies) {
            const totalStrategies = strategies.length;
            let totalTrades = 0;
            let totalWinRate = 0;
            let totalPnl = 0;

            strategies.forEach(strategy => {
                const metrics = strategy.metrics || {};
                totalTrades += metrics.total_trades || 0;
                totalWinRate += metrics.win_rate || 0;
                totalPnl += metrics.total_pnl || 0;
            });

            const avgWinRate = totalStrategies > 0 ? (totalWinRate / totalStrategies).toFixed(1) : 0;

            document.getElementById('total-strategies').textContent = totalStrategies;
            document.getElementById('total-trades').textContent = totalTrades.toLocaleString();
            document.getElementById('avg-win-rate').textContent = avgWinRate + '%';
            document.getElementById('total-pnl').textContent = '$' + totalPnl.toFixed(2);
            document.getElementById('total-pnl').className = totalPnl > 0 ? 'positive' : totalPnl < 0 ? 'negative' : 'neutral';
        }
    </script>
</body>
</html>

