<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>System Status - AI Trading System</title>
    
    <!-- Bootstrap 5.3 for Toast Notifications -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Socket.IO for Real-time Toast Notifications -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0a0e1a 0%, #1a1f2e 100%);
            color: #e0e0e0;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }
        
        header {
            background: linear-gradient(135deg, #1a1f2e 0%, #252b3e 100%);
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 30px;
            border-left: 5px solid #00d4aa;
        }
        
        h1 {
            color: #00d4aa;
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .subtitle {
            color: #8892a6;
            font-size: 16px;
        }
        
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .status-card {
            background: #1a1f2e;
            padding: 24px;
            border-radius: 12px;
            border-left: 4px solid #00d4aa;
        }
        
        .status-card.warning {
            border-left-color: #ffa502;
        }
        
        .status-card.error {
            border-left-color: #ff4757;
        }
        
        .status-label {
            color: #8892a6;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }
        
        .status-value {
            font-size: 28px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 8px;
        }
        
        .status-value.online {
            color: #00d4aa;
        }
        
        .status-value.offline {
            color: #ff4757;
        }
        
        .status-desc {
            color: #b0b6c3;
            font-size: 13px;
        }
        
        .accounts-section {
            background: #1a1f2e;
            padding: 30px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        
        .section-title {
            color: #00d4aa;
            font-size: 24px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .account-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 20px;
        }
        
        .account-card {
            background: #252b3e;
            padding: 24px;
            border-radius: 10px;
            border-left: 4px solid #00d4aa;
        }
        
        .account-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .account-name {
            font-size: 20px;
            font-weight: 700;
            color: #00d4aa;
        }
        
        .account-balance {
            font-size: 26px;
            font-weight: 800;
            color: #ffffff;
        }
        
        .account-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(136, 146, 166, 0.2);
        }
        
        .account-row:last-child {
            border-bottom: none;
        }
        
        .account-label {
            color: #8892a6;
            font-size: 14px;
        }
        
        .account-value {
            color: #ffffff;
            font-weight: 600;
            font-size: 14px;
        }
        
        .positive {
            color: #00d4aa;
        }
        
        .negative {
            color: #ff4757;
        }
        
        .loading {
            text-align: center;
            padding: 60px;
            color: #8892a6;
            font-size: 18px;
        }
        
        .refresh-info {
            text-align: center;
            color: #8892a6;
            font-size: 13px;
            margin-top: 30px;
        }
        
        .badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 16px;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
        }
        
        .badge-success {
            background: rgba(0, 212, 170, 0.3);
            color: #00d4aa;
        }
        
        .badge-warning {
            background: rgba(255, 165, 2, 0.3);
            color: #ffa502;
        }
        
        .badge-danger {
            background: rgba(255, 71, 87, 0.3);
            color: #ff4757;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ“Š System Status Dashboard</h1>
            <p class="subtitle">Real-time trading system health and monitoring</p>
        </header>
        
        <div id="loading" class="loading">
            Loading system status...
        </div>
        
        <div id="content" style="display: none;">
            <div class="status-grid">
                <div class="status-card">
                    <div class="status-label">System Status</div>
                    <div class="status-value online" id="system-status">Online</div>
                    <div class="status-desc" id="system-desc">All systems operational</div>
                </div>
                
                <div class="status-card">
                    <div class="status-label">Data Feed</div>
                    <div class="status-value online" id="data-feed">Active</div>
                    <div class="status-desc">Streaming from OANDA</div>
                </div>
                
                <div class="status-card">
                    <div class="status-label">Active Accounts</div>
                    <div class="status-value" id="active-accounts">0</div>
                    <div class="status-desc">Demo accounts connected</div>
                </div>
                
                <div class="status-card">
                    <div class="status-label">Total Trades</div>
                    <div class="status-value" id="total-trades">0</div>
                    <div class="status-desc">Open positions</div>
                </div>
                
                <div class="status-card">
                    <div class="status-label">Portfolio Value</div>
                    <div class="status-value" id="portfolio-value">$0</div>
                    <div class="status-desc">Total across all accounts</div>
                </div>
                
                <div class="status-card">
                    <div class="status-label">Live Data Mode</div>
                    <div class="status-value online" id="live-mode">Enabled</div>
                    <div class="status-desc">Real-time OANDA feed</div>
                </div>
            </div>
            
            <div class="accounts-section">
                <div class="section-title">ðŸ’° Account Details</div>
                <div class="account-grid" id="accounts-grid"></div>
            </div>
        </div>
        
        <div class="refresh-info">
            Auto-refreshing every 15 seconds | Last update: <span id="last-update">Never</span>
        </div>
    </div>
    
    <script>
        async function loadStatus() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                
                // Update system status
                const systemStatus = data.system_status || 'unknown';
                document.getElementById('system-status').textContent = systemStatus.toUpperCase();
                document.getElementById('system-status').className = 
                    systemStatus === 'online' ? 'status-value online' : 'status-value offline';
                
                // Update data feed
                const dataFeed = data.data_feed_status || 'unknown';
                document.getElementById('data-feed').textContent = dataFeed.toUpperCase();
                
                // Update stats
                const accounts = data.account_statuses || {};
                const accountCount = Object.keys(accounts).length;
                document.getElementById('active-accounts').textContent = accountCount;
                
                let totalTrades = 0;
                let totalBalance = 0;
                
                for (const acc of Object.values(accounts)) {
                    totalTrades += acc.open_trades || 0;
                    totalBalance += acc.balance || 0;
                }
                
                document.getElementById('total-trades').textContent = totalTrades;
                document.getElementById('portfolio-value').textContent = 
                    '$' + totalBalance.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
                
                // Update live mode
                const liveMode = data.live_data_mode;
                document.getElementById('live-mode').textContent = liveMode ? 'ENABLED' : 'DISABLED';
                document.getElementById('live-mode').className = 
                    liveMode ? 'status-value online' : 'status-value offline';
                
                // Render accounts
                const accountsGrid = document.getElementById('accounts-grid');
                accountsGrid.innerHTML = Object.entries(accounts).map(([accId, acc]) => {
                    const uplClass = (acc.unrealized_pl || 0) >= 0 ? 'positive' : 'negative';
                    
                    return `
                        <div class="account-card">
                            <div class="account-header">
                                <div class="account-name">${acc.account_name || accId.slice(-3)}</div>
                                <div class="account-balance">$${(acc.balance || 0).toLocaleString('en-US', {minimumFractionDigits: 2})}</div>
                            </div>
                            <div class="account-row">
                                <div class="account-label">Account ID</div>
                                <div class="account-value">${accId}</div>
                            </div>
                            <div class="account-row">
                                <div class="account-label">Strategy</div>
                                <div class="account-value">${acc.strategy || 'Unknown'}</div>
                            </div>
                            <div class="account-row">
                                <div class="account-label">Unrealized P&L</div>
                                <div class="account-value ${uplClass}">$${(acc.unrealized_pl || 0).toLocaleString('en-US', {minimumFractionDigits: 2})}</div>
                            </div>
                            <div class="account-row">
                                <div class="account-label">Open Positions</div>
                                <div class="account-value">${acc.open_positions || 0}</div>
                            </div>
                            <div class="account-row">
                                <div class="account-label">Open Trades</div>
                                <div class="account-value">${acc.open_trades || 0}</div>
                            </div>
                            <div class="account-row">
                                <div class="account-label">Margin Used</div>
                                <div class="account-value">$${(acc.margin_used || 0).toLocaleString('en-US', {minimumFractionDigits: 2})}</div>
                            </div>
                            <div class="account-row">
                                <div class="account-label">Instruments</div>
                                <div class="account-value">${(acc.instruments || []).join(', ')}</div>
                            </div>
                            <div class="account-row">
                                <div class="account-label">Status</div>
                                <div class="account-value"><span class="badge badge-success">${acc.status || 'active'}</span></div>
                            </div>
                        </div>
                    `;
                }).join('');
                
                // Update timestamp
                document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
                
                // Show content
                document.getElementById('loading').style.display = 'none';
                document.getElementById('content').style.display = 'block';
                
            } catch (error) {
                console.error('Failed to load status:', error);
                document.getElementById('loading').textContent = 'Error loading status. Retrying...';
                setTimeout(loadStatus, 5000);
            }
        }
        
        // Load on page load
        loadStatus();
        
        // Auto-refresh every 15 seconds
        setInterval(loadStatus, 15000);
    </script>
    
    <!-- Toast Notification System -->
    {% include 'components/toast_notifications.html' %}
</body>
</html>

