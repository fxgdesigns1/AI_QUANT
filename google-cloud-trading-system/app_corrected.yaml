# Google Cloud Trading System - App Engine Configuration - CORRECTED VERSION
# Production-ready configuration for live OANDA trading
# FIXED: Strategy mappings aligned with dashboard

# =============================================================================
# Runtime Configuration
# =============================================================================
runtime: python39

# =============================================================================
# Service Configuration
# =============================================================================
service: default
entrypoint: python main.py

# =============================================================================
# Automatic Scaling Configuration
# =============================================================================
automatic_scaling:
  # Minimum number of instances
  min_instances: 1
  
  # Maximum number of instances
  max_instances: 10
  
  # Target CPU utilization (0.0 to 1.0)
  target_cpu_utilization: 0.6
  
  # Target throughput utilization (0.0 to 1.0)
  target_throughput_utilization: 0.6
  
  # Minimum pending latency (seconds)
  min_pending_latency: 30ms
  
  # Maximum pending latency (seconds)
  max_pending_latency: 200ms

# =============================================================================
# Instance Configuration
# =============================================================================
instance_class: F2

# =============================================================================
# Environment Variables
# =============================================================================
env_variables:
  # Flask Configuration
  FLASK_ENV: production
  FLASK_DEBUG: "False"
  PORT: "8080"
  
  # OANDA API Configuration - LIVE DEMO ACCOUNTS
  OANDA_API_KEY: "REMOVED_SECRET"
  OANDA_ENVIRONMENT: "practice"
  OANDA_BASE_URL: "https://api-fxpractice.oanda.com"
  
  # Account Configuration
  PRIMARY_ACCOUNT: "101-004-30719775-009"
  GOLD_SCALP_ACCOUNT: "101-004-30719775-010"
  STRATEGY_ALPHA_ACCOUNT: "101-004-30719775-011"
  
  # Strategy Mapping - CORRECTED
  PRIMARY_STRATEGY: "gold_scalping"
  GOLD_SCALP_STRATEGY: "ultra_strict_forex"
  STRATEGY_ALPHA_STRATEGY: "momentum_trading"
  
  # Telegram Configuration (optional)
  TELEGRAM_TOKEN: "7248728383:AAFpLNAlidybk7ed56bosfi8W_e1MaX7Oxs"
  TELEGRAM_CHAT_ID: "6100678501"
  
  # Google Cloud Configuration
  GOOGLE_CLOUD_PROJECT: "ai-quant-trading"
  GOOGLE_CLOUD_REGION: "us-central1"
  
  # Risk Management Settings - Primary Account (Gold Scalping 5M) - CORRECTED
  PRIMARY_MAX_RISK_PER_TRADE: "0.02"
  PRIMARY_MAX_PORTFOLIO_RISK: "0.75"
  PRIMARY_MAX_POSITIONS: "5"
  PRIMARY_DAILY_TRADE_LIMIT: "50"
  
  # Risk Management Settings - Gold Scalping Account (Ultra Strict Fx 15M) - CORRECTED
  GOLD_MAX_RISK_PER_TRADE: "0.015"
  GOLD_MAX_PORTFOLIO_RISK: "0.75"
  GOLD_MAX_POSITIONS: "3"
  GOLD_DAILY_TRADE_LIMIT: "100"
  
  # Risk Management Settings - Strategy Alpha Account (Momentum)
  ALPHA_MAX_RISK_PER_TRADE: "0.025"
  ALPHA_MAX_PORTFOLIO_RISK: "0.75"
  ALPHA_MAX_POSITIONS: "7"
  ALPHA_DAILY_TRADE_LIMIT: "30"
  
  # Global Risk Settings
  MAX_CORRELATION_RISK: "0.75"
  POSITION_SIZING_METHOD: "risk_based"
  POSITION_SIZE_MULTIPLIER: "0.5"
  FORCED_TRADING_MODE: "enabled"
  MIN_TRADES_TODAY: "2"
  
  # Data Validation Settings
  MAX_DATA_AGE_SECONDS: "300"
  MIN_CONFIDENCE_THRESHOLD: "0.5"
  REQUIRE_LIVE_DATA: "True"
  
  # Trading System Configuration
  MOCK_TRADING: "False"
  DEVELOPMENT_MODE: "False"
  
  # Logging Configuration
  LOG_LEVEL: "INFO"
  ENABLE_STRUCTURED_LOGGING: "True"
  
  # Performance Settings
  DASHBOARD_UPDATE_INTERVAL: "15"
  MARKET_DATA_UPDATE_INTERVAL: "5"
  SYSTEM_STATUS_CHECK_INTERVAL: "30"
  
  # Security Settings
  API_RATE_LIMIT: "100"
  API_RATE_WINDOW: "60"
  CORS_ORIGINS: "*"
  
  # AI Assistant Configuration
  AI_ASSISTANT_ENABLED: "true"
  AI_MODEL_PROVIDER: "demo"
  AI_RATE_LIMIT_PER_MINUTE: "10"
  AI_REQUIRE_LIVE_CONFIRMATION: "true"

# =============================================================================
# Handlers Configuration
# =============================================================================
handlers:
  # Static files handler
  - url: /static
    static_dir: static
    secure: always
    
  # Main application handler
  - url: /tasks/.*
    script: auto
    secure: always
    login: admin
  - url: /.*
    script: auto
    secure: always

# =============================================================================
# Libraries Configuration
# =============================================================================
# Note: Required libraries are specified in requirements.txt

# =============================================================================
# Network Configuration
# =============================================================================
network:
  # Enable session affinity for WebSocket connections
  session_affinity: true
  
  # Forwarded port configuration
  forwarded_ports:
    - 8080

# =============================================================================
# Health Check Configuration
# =============================================================================
readiness_check:
  path: "/api/health"
  check_interval_sec: 5
  timeout_sec: 4
  failure_threshold: 2
  success_threshold: 2
  app_start_timeout_sec: 300

liveness_check:
  path: "/api/health"
  check_interval_sec: 30
  timeout_sec: 4
  failure_threshold: 4
  success_threshold: 2

# =============================================================================
# Resource Limits
# =============================================================================
resources:
  cpu: 1
  memory_gb: 2
  disk_size_gb: 10

# =============================================================================
# Beta Features
# =============================================================================
beta_settings:
  # Enable Cloud Build for automatic deployments
  cloud_build: true

