<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trade Suggestions Dashboard</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        .header h1 {
            margin: 0;
            font-size: 2.5em;
            font-weight: 300;
        }
        
        .header p {
            margin: 10px 0 0 0;
            opacity: 0.8;
            font-size: 1.1em;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }
        
        .panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }
        
        .panel h2 {
            margin: 0 0 20px 0;
            color: #2c3e50;
            font-size: 1.5em;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        
        .suggestion-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 4px solid #3498db;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        
        .suggestion-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        
        .suggestion-card.high-confidence {
            border-left-color: #27ae60;
        }
        
        .suggestion-card.medium-confidence {
            border-left-color: #f39c12;
        }
        
        .suggestion-card.low-confidence {
            border-left-color: #e74c3c;
        }
        
        .suggestion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .instrument {
            font-size: 1.3em;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .direction {
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 0.9em;
        }
        
        .direction.buy {
            background: #27ae60;
            color: white;
        }
        
        .direction.sell {
            background: #e74c3c;
            color: white;
        }
        
        .suggestion-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .detail-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #ecf0f1;
        }
        
        .detail-label {
            font-weight: 600;
            color: #7f8c8d;
        }
        
        .detail-value {
            color: #2c3e50;
            font-weight: 500;
        }
        
        .confidence-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .confidence-fill {
            height: 100%;
            transition: width 0.3s ease;
        }
        
        .confidence-fill.high {
            background: #27ae60;
        }
        
        .confidence-fill.medium {
            background: #f39c12;
        }
        
        .confidence-fill.low {
            background: #e74c3c;
        }
        
        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }
        
        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            flex: 1;
        }
        
        .btn-approve {
            background: #27ae60;
            color: white;
        }
        
        .btn-approve:hover {
            background: #229954;
            transform: translateY(-1px);
        }
        
        .btn-reject {
            background: #e74c3c;
            color: white;
        }
        
        .btn-reject:hover {
            background: #c0392b;
            transform: translateY(-1px);
        }
        
        .btn-execute {
            background: #3498db;
            color: white;
        }
        
        .btn-execute:hover {
            background: #2980b9;
            transform: translateY(-1px);
        }
        
        .status-badge {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8em;
            font-weight: bold;
        }
        
        .status-pending {
            background: #f39c12;
            color: white;
        }
        
        .status-approved {
            background: #27ae60;
            color: white;
        }
        
        .status-rejected {
            background: #e74c3c;
            color: white;
        }
        
        .status-executed {
            background: #3498db;
            color: white;
        }
        
        .generate-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 20px;
            width: 100%;
        }
        
        .generate-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        
        .empty-state {
            text-align: center;
            padding: 40px;
            color: #7f8c8d;
        }
        
        .empty-state i {
            font-size: 3em;
            margin-bottom: 20px;
            opacity: 0.5;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #7f8c8d;
            font-size: 0.9em;
        }
        
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
                gap: 20px;
                padding: 20px;
            }
            
            .suggestion-details {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Trade Suggestions Dashboard</h1>
            <p>AI-Powered Trading Opportunities & Execution</p>
        </div>
        
        <div class="dashboard-grid">
            <div class="panel">
                <h2>üìä Trading Opportunities</h2>
                <button class="generate-btn" onclick="generateSuggestions()">
                    üîç Generate New Suggestions
                </button>
                <button class="generate-btn" onclick="loadSuggestions()" style="background: #27ae60; margin-top: 10px;">
                    üìä Load Existing Suggestions
                </button>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="total-suggestions">0</div>
                        <div class="stat-label">Total Suggestions</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="pending-trades">0</div>
                        <div class="stat-label">Pending Trades</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="executed-trades">0</div>
                        <div class="stat-label">Executed Today</div>
                    </div>
                </div>
                
                <div id="suggestions-container">
                    <div class="empty-state">
                        <i>üìà</i>
                        <p>No suggestions yet. Click "Generate New Suggestions" to start!</p>
                    </div>
                </div>
            </div>
            
            <div class="panel">
                <h2>‚ö° Quick Actions</h2>
                <div id="pending-trades-container">
                    <div class="empty-state">
                        <i>‚è≥</i>
                        <p>No pending trades</p>
                    </div>
                </div>
                
                <div id="executed-trades-container">
                    <h3>‚úÖ Recently Executed</h3>
                    <div class="empty-state">
                        <i>üìã</i>
                        <p>No executed trades yet</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // WebSocket connection
        const socket = io();
        
        // State management
        let suggestions = [];
        let pendingTrades = [];
        let executedTrades = [];
        
        // WebSocket event handlers
        socket.on('connect', function() {
            console.log('Connected to trade suggestions API');
            loadInitialData();
        });
        
        socket.on('new_suggestions', function(data) {
            suggestions = data.suggestions;
            updateSuggestionsDisplay();
            updateStats();
        });
        
        socket.on('suggestion_approved', function(data) {
            console.log('Suggestion approved:', data);
            loadPendingTrades();
        });
        
        socket.on('suggestion_rejected', function(data) {
            console.log('Suggestion rejected:', data);
            loadSuggestions();
        });
        
        socket.on('trade_executed', function(data) {
            console.log('Trade executed:', data);
            loadExecutedTrades();
            loadPendingTrades();
        });
        
        // Load initial data
        function loadInitialData() {
            console.log('üîÑ Loading initial data...');
            loadSuggestions();
            loadPendingTrades();
            loadExecutedTrades();
        }
        
        // Auto-load suggestions on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ Page loaded, auto-generating suggestions...');
            generateSuggestions();
        });
        
        // Load suggestions
        function loadSuggestions() {
            console.log('üìä Loading suggestions...');
            fetch('/api/suggestions')
                .then(response => {
                    console.log('üì° Response status:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('üìä Suggestions data:', data);
                    if (data.success) {
                        suggestions = data.suggestions;
                        console.log('‚úÖ Loaded', suggestions.length, 'suggestions');
                        updateSuggestionsDisplay();
                        updateStats();
                    } else {
                        console.error('‚ùå API error:', data.error);
                    }
                })
                .catch(error => {
                    console.error('‚ùå Error loading suggestions:', error);
                    // Show error in UI
                    const container = document.getElementById('suggestions-container');
                    container.innerHTML = `
                        <div class="empty-state">
                            <i>‚ùå</i>
                            <p>Error loading suggestions: ${error.message}</p>
                            <button class="generate-btn" onclick="generateSuggestions()">Try Again</button>
                        </div>
                    `;
                });
        }
        
        // Generate new suggestions
        function generateSuggestions() {
            console.log('üîÑ Generating new suggestions...');
            fetch('/api/suggestions/generate', { method: 'POST' })
                .then(response => {
                    console.log('üì° Generate response status:', response.status);
                    return response.json();
                })
                .then(data => {
                    console.log('üîÑ Generate data:', data);
                    if (data.success) {
                        suggestions = data.suggestions;
                        console.log('‚úÖ Generated', suggestions.length, 'suggestions');
                        updateSuggestionsDisplay();
                        updateStats();
                    } else {
                        console.error('‚ùå Generate error:', data.error);
                    }
                })
                .catch(error => {
                    console.error('‚ùå Error generating suggestions:', error);
                    // Show error in UI
                    const container = document.getElementById('suggestions-container');
                    container.innerHTML = `
                        <div class="empty-state">
                            <i>‚ùå</i>
                            <p>Error generating suggestions: ${error.message}</p>
                            <button class="generate-btn" onclick="generateSuggestions()">Try Again</button>
                        </div>
                    `;
                });
        }
        
        // Update suggestions display
        function updateSuggestionsDisplay() {
            const container = document.getElementById('suggestions-container');
            
            if (suggestions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i>üìà</i>
                        <p>No suggestions available</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = suggestions.map(suggestion => `
                <div class="suggestion-card ${getConfidenceClass(suggestion.confidence)}">
                    <div class="suggestion-header">
                        <div class="instrument">${suggestion.instrument}</div>
                        <div class="direction ${suggestion.direction.toLowerCase()}">${suggestion.direction}</div>
                    </div>
                    
                    <div class="suggestion-details">
                        <div class="detail-item">
                            <span class="detail-label">Current Price:</span>
                            <span class="detail-value">${suggestion.current_price.toFixed(5)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Entry Price:</span>
                            <span class="detail-value">${suggestion.entry_price.toFixed(5)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Stop Loss:</span>
                            <span class="detail-value">${suggestion.stop_loss.toFixed(5)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Take Profit:</span>
                            <span class="detail-value">${suggestion.take_profit.toFixed(5)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Risk-Reward:</span>
                            <span class="detail-value">1:${suggestion.risk_reward_ratio.toFixed(1)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Risk (Pips):</span>
                            <span class="detail-value">${suggestion.risk_pips}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Reward (Pips):</span>
                            <span class="detail-value">${suggestion.reward_pips}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Distance from Entry:</span>
                            <span class="detail-value">${suggestion.pip_distance_from_entry} pips</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Spread:</span>
                            <span class="detail-value">${suggestion.spread.toFixed(5)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Risk Level:</span>
                            <span class="detail-value">${suggestion.risk_level}</span>
                        </div>
                    </div>
                    
                    <div class="confidence-bar">
                        <div class="confidence-fill ${getConfidenceClass(suggestion.confidence)}" 
                             style="width: ${suggestion.confidence * 100}%"></div>
                    </div>
                    
                    <div style="margin: 10px 0; font-size: 0.9em; color: #7f8c8d;">
                        <strong>Market Conditions:</strong> ${suggestion.market_conditions}<br>
                        <strong>Analysis:</strong> ${suggestion.reason}
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-approve" onclick="approveSuggestion('${suggestion.id}')">
                            ‚úÖ Approve
                        </button>
                        <button class="btn btn-reject" onclick="rejectSuggestion('${suggestion.id}')">
                            ‚ùå Reject
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        // Approve suggestion
        function approveSuggestion(suggestionId) {
            fetch(`/api/trade-suggestions/${suggestionId}/approve`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        console.log('Suggestion approved:', data);
                        loadSuggestions();
                        loadPendingTrades();
                    } else {
                        alert('Error approving suggestion: ' + data.error);
                    }
                })
                .catch(error => console.error('Error approving suggestion:', error));
        }
        
        // Reject suggestion
        function rejectSuggestion(suggestionId) {
            fetch(`/api/trade-suggestions/${suggestionId}/reject`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        console.log('Suggestion rejected:', data);
                        loadSuggestions();
                    } else {
                        alert('Error rejecting suggestion: ' + data.error);
                    }
                })
                .catch(error => console.error('Error rejecting suggestion:', error));
        }
        
        // Load pending trades
        function loadPendingTrades() {
            fetch('/api/trades/pending')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        pendingTrades = data.trades;
                        updatePendingTradesDisplay();
                        updateStats();
                    }
                })
                .catch(error => console.error('Error loading pending trades:', error));
        }
        
        // Update pending trades display
        function updatePendingTradesDisplay() {
            const container = document.getElementById('pending-trades-container');
            
            if (pendingTrades.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i>‚è≥</i>
                        <p>No pending trades</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = pendingTrades.map(trade => `
                <div class="suggestion-card">
                    <div class="suggestion-header">
                        <div class="instrument">${trade.instrument}</div>
                        <div class="status-badge status-${trade.status.toLowerCase().replace('_', '-')}">
                            ${trade.status.replace('_', ' ')}
                        </div>
                    </div>
                    
                    <div class="suggestion-details">
                        <div class="detail-item">
                            <span class="detail-label">Direction:</span>
                            <span class="detail-value">${trade.direction}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Price:</span>
                            <span class="detail-value">${trade.price.toFixed(5)}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Account:</span>
                            <span class="detail-value">${trade.account_id}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Created:</span>
                            <span class="detail-value">${new Date(trade.created_at).toLocaleTimeString()}</span>
                        </div>
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn btn-execute" onclick="executeTrade('${trade.id}')">
                            üöÄ Execute Trade
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        // Execute trade
        function executeTrade(tradeId) {
            if (confirm('Are you sure you want to execute this trade?')) {
                fetch(`/api/trades/${tradeId}/execute`, { method: 'POST' })
                    .then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            alert('Trade executed successfully! Order ID: ' + data.order_id);
                            loadPendingTrades();
                            loadExecutedTrades();
                        } else {
                            alert('Error executing trade: ' + data.error);
                        }
                    })
                    .catch(error => console.error('Error executing trade:', error));
            }
        }
        
        // Load executed trades
        function loadExecutedTrades() {
            fetch('/api/trades/executed')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        executedTrades = data.trades;
                        updateExecutedTradesDisplay();
                        updateStats();
                    }
                })
                .catch(error => console.error('Error loading executed trades:', error));
        }
        
        // Update executed trades display
        function updateExecutedTradesDisplay() {
            const container = document.getElementById('executed-trades-container');
            
            if (executedTrades.length === 0) {
                container.innerHTML = `
                    <h3>‚úÖ Recently Executed</h3>
                    <div class="empty-state">
                        <i>üìã</i>
                        <p>No executed trades yet</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = `
                <h3>‚úÖ Recently Executed</h3>
                ${executedTrades.slice(0, 5).map(trade => `
                    <div class="suggestion-card">
                        <div class="suggestion-header">
                            <div class="instrument">${trade.instrument}</div>
                            <div class="status-badge status-executed">EXECUTED</div>
                        </div>
                        <div class="suggestion-details">
                            <div class="detail-item">
                                <span class="detail-label">Direction:</span>
                                <span class="detail-value">${trade.direction}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Order ID:</span>
                                <span class="detail-value">${trade.order_id || 'N/A'}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Executed:</span>
                                <span class="detail-value">${new Date(trade.executed_at).toLocaleTimeString()}</span>
                            </div>
                        </div>
                    </div>
                `).join('')}
            `;
        }
        
        // Update stats
        function updateStats() {
            document.getElementById('total-suggestions').textContent = suggestions.length;
            document.getElementById('pending-trades').textContent = pendingTrades.length;
            document.getElementById('executed-trades').textContent = executedTrades.length;
        }
        
        // Get confidence class
        function getConfidenceClass(confidence) {
            if (confidence >= 0.8) return 'high-confidence';
            if (confidence >= 0.6) return 'medium-confidence';
            return 'low-confidence';
        }
        
        // Auto-refresh every 30 seconds
        setInterval(() => {
            loadInitialData();
        }, 30000);
    </script>
</body>
</html>

